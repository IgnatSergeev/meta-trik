#!/bin/sh
VIDEO0=/dev/video0
VIDEO1=/dev/video1

case $1 in  
  0|$VIDEO0)
    BUS=0x1
    VIDEO_PATH=$VIDEO0
    echo 0 > /sys/class/gpio/gpio109/value
    usleep 10000
    echo 1 > /sys/class/gpio/gpio109/value
    ;;
  1|$VIDEO1)
    BUS=0x2
    VIDEO_PATH=$VIDEO1
    echo 0 > /sys/class/gpio/gpio33/value
    usleep 10000
    echo 1 > /sys/class/gpio/gpio33/value
    ;;
  *)
    USAGE_TEXT="Inits ov7670. Usage:\n\t 1, $VIDEO1 \n\t 0, $VIDEO0\n"
    printf "$USAGE_TEXT"
    exit 1
    ;;
esac

cam () {
  i2cset -y $BUS 0x21 $1 $2 || exit $?
}

cam 0x12 0x80
#sleep 1
cam 0x12 0x00
cam 0x04 0x40
cam 0x40 0x80

cam 0x17 0x13
cam 0x18 0x01
cam 0x32 0x80
cam 0x19 0x02
cam 0x1a 0x7a
cam 0x03 0x0a

cam 0x0c 0x04
cam 0x3e 0x19
cam 0x72 0x11
cam 0x73 0xf1

cam 0xb0 0x84 #change green/purple stuff on true colors
cam 0x3a 0x09

cam 0x09 0x03

#not so bright
cam 0x14 0x1a 

#turn on all stuff (awb/agc/aec)
cam 0x13 0x87

#simple AWB
cam 0x6f 0x6f

#pretty agc/aec
cam 0xa5 0x05
cam 0x24 0x95
cam 0x25 0x33
cam 0x26 0xe3
cam 0x9f 0x78 
cam 0xa0 0x68 
cam 0xa6 0xd8 
cam 0xa7 0xd8 
cam 0xa9 0x90 
cam 0xaa 0x94 

#banding filter
cam 0x9d 0x98
cam 0x9e 0x7f
cam 0xa5 0x02
cam 0xab 0x03
cam 0x3b 0x12

#double YUV
cam 0x41 0x0a

#yuv
cam 0x4f 0x80
cam 0x50 0x70
cam 0x51 0x1a
cam 0x52 0x28
cam 0x53 0x15
cam 0x54 0x40

#cam 0x20 0x0f //darker sharper

v4l2-ctl -d $VIDEO_PATH -s pal 1 > /dev/null
echo "ov7670 successfully initialised"
